<!DOCTYPE html>
<html>
<head>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAJrwnSThnUGXMjlCaJrWHmczNnzXVBSNo&libraries=visualization&callback=initialize" async defer>
  </script>


<script>
var map,heatmap;
var points = [];
function initialize() {
  var mapProp = {
    center:new google.maps.LatLng(<%=lat%>, <%=lon%>),
    zoom:12,
    mapTypeId:google.maps.MapTypeId.ROADMAP
  };
  map=new google.maps.Map(document.getElementById("googleMap"), mapProp);
  heatmap = new google.maps.visualization.HeatmapLayer({
          data: points,
          map: map
        });
  
  var infoWindow = new google.maps.InfoWindow();
function addMarkers(map, loc, text, author,urlThumb, urlSmall ) {
    var marker = new google.maps.Marker({
       position: loc,
       icon: 'http://maps.google.com/mapfiles/ms/icons/red-dot.png',
       label: '',
       map: map,
       title: 'StreetArt'
    });
    var point = new google.maps.LatLng(loc[0], loc[1]);
    points.push(point);
    var content = "<div class='info'><br><h3 class='infotitle'>" + text + "</h3><br>" +
            "<p class='infodesc'><img src=" + urlThumb + "/></p><br>" +
            "<p>Posted by: " + author + "</p></div>";
    google.maps.event.addListener(marker, "click", function () {
       marker.setIcon('http://maps.google.com/mapfiles/ms/icons/green-dot.png');
       infoWindow.setContent(content);
       infoWindow.open(map, this);
    });   
}




<% for(var i=0; i<photos.length; i++) { %>
            addMarkers(map, {lat: <%= photos[i].lat %>, lng: <%= photos[i].lon %>}, "<%= photos[i].text %>", "<%= photos[i].author %>", "<%= photos[i].urlFlickerThumb %>", "<%= photos[i].urlFlickerSmall %>"  );
        <% } %>

}

function toggleHeatmap() {
        
        heatmap.setMap(heatmap.getMap() ? null : map);
      }
google.maps.event.addDomListener(window, 'load', initialize);
</script>
</head>

<body>
<button onclick="toggleHeatmap()">Toggle Heatmap</button>
<div id="googleMap" style="width:1000px;height:700px;"></div>

</body>
</html>